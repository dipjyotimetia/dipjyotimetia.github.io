"use strict";(self.webpackChunktech_blog=self.webpackChunktech_blog||[]).push([[537],{807:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>a});var c=o(5893),n=o(1151);const r={id:"google1",title:"Get Started",sidebar_label:"Get Started"},l=void 0,s={id:"snippets/cloud/google/google1",title:"Get Started",description:"Google cloud sketch",source:"@site/docs/snippets/cloud/google/google1.mdx",sourceDirName:"snippets/cloud/google",slug:"/snippets/cloud/google/google1",permalink:"/docs/snippets/cloud/google/google1",draft:!1,unlisted:!1,editUrl:"https://github.com/dipjyotimetia/Docs/docs/snippets/cloud/google/google1.mdx",tags:[],version:"current",frontMatter:{id:"google1",title:"Get Started",sidebar_label:"Get Started"},sidebar:"Docs",previous:{title:"AWS Well-Architected Framework",permalink:"/docs/snippets/cloud/aws/aws13"},next:{title:"Google Kubernetes Engine",permalink:"/docs/snippets/cloud/google/gke"}},i={},a=[{value:"Google cloud sketch",id:"google-cloud-sketch",level:2},{value:"Example repository",id:"example-repository",level:2},{value:"Activate project",id:"activate-project",level:3},{value:"Create cloud pubsub topic",id:"create-cloud-pubsub-topic",level:3},{value:"Create service account &amp; add roles",id:"create-service-account--add-roles",level:3},{value:"Enable the project to create Pub/Sub authentication tokens",id:"enable-the-project-to-create-pubsub-authentication-tokens",level:3},{value:"Cloud storage trigger",id:"cloud-storage-trigger",level:3},{value:"Deploy to container registry",id:"deploy-to-container-registry",level:3},{value:"Build and deploy to cloud run",id:"build-and-deploy-to-cloud-run",level:3},{value:"Get deployment url",id:"get-deployment-url",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.h2,{id:"google-cloud-sketch",children:"Google cloud sketch"}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.a,{href:"https://thecloudgirl.dev/",children:"SketchNotes"})}),"\n",(0,c.jsx)(t.h2,{id:"example-repository",children:"Example repository"}),"\n",(0,c.jsx)(t.p,{children:(0,c.jsx)(t.a,{href:"https://github.com/rosera/pet-theory.git",children:"GitHub"})}),"\n",(0,c.jsx)(t.h3,{id:"activate-project",children:"Activate project"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"export PROJECT_ID=\"\"\ngcloud config list project\ngcloud config set project $PROJECT_ID\ngcloud config set project $(gcloud projects list --format='value(PROJECT_ID)' --filter='qwiklabs-gcp')\n"})}),"\n",(0,c.jsx)(t.h3,{id:"create-cloud-pubsub-topic",children:"Create cloud pubsub topic"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'export TOPIC_NAME=""\nexport TOPIC_SUBSCRIPTION_NAME=""\nexport SERVICE_ACCOUNT_NAME=""\nexport SERVICE_URL=""\n#pubsub create topic\ngcloud pubsub topics create $TOPIC_NAME\n#pubsub subscription\ngcloud pubsub subscriptions create $TOPIC_SUBSCRIPTION_NAME --topic $TOPIC_NAME --push-endpoint=$SERVICE_URL --push-auth-service-account=$SERVICE_ACCOUNT_NAME@$GOOGLE_CLOUD_PROJECT.iam.gserviceaccount.com\n'})}),"\n",(0,c.jsx)(t.h3,{id:"create-service-account--add-roles",children:"Create service account & add roles"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'export SERVICE_ACCOUNT_NAME=""\nexport SERVICE_NAME=""\nexport DISPLAY_NAME=""\n\ngcloud iam service-accounts create $SERVICE_ACCOUNT_NAME --display-name $DISPLAY_NAME\n\ngcloud run services add-iam-policy-binding $SERVICE_NAME --member=serviceAccount:$SERVICE_ACCOUNT_NAME@$GOOGLE_CLOUD_PROJECT.iam.gserviceaccount.com --role=roles/run.invoker --region us-central1 --platform managed\n'})}),"\n",(0,c.jsx)(t.h3,{id:"enable-the-project-to-create-pubsub-authentication-tokens",children:"Enable the project to create Pub/Sub authentication tokens"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'PROJECT_NUMBER=$(gcloud projects list --filter="qwiklabs-gcp" --format=\'value(PROJECT_NUMBER)\')\n\ngcloud projects add-iam-policy-binding $GOOGLE_CLOUD_PROJECT --member=serviceAccount:service-$PROJECT_NUMBER@gcp-sa-pubsub.iam.gserviceaccount.com --role=roles/iam.serviceAccountTokenCreator\n\ncurl -X GET -H "Authorization: Bearer $(gcloud auth print-identity-token)" $SERVICE_URL\n'})}),"\n",(0,c.jsx)(t.h3,{id:"cloud-storage-trigger",children:"Cloud storage trigger"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"gcloud pubsub subscriptions create $TOPIC_SUBSCRIPTION \\\n  --topic $TOPIC_NAME \\\n  --push-endpoint=$SERVICE_URL \\\n  --push-auth-service-account=$SERVICE_ACCOUNT@$GOOGLE_CLOUD_PROJECT.iam.gserviceaccount.com\n"})}),"\n",(0,c.jsx)(t.h3,{id:"deploy-to-container-registry",children:"Deploy to container registry"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'export DOCKER_TAG="rest-api:0.1"\ngcloud builds submit \\\n  --tag gcr.io/$GOOGLE_CLOUD_PROJECT/$DOCKER_TAG\n'})}),"\n",(0,c.jsx)(t.h3,{id:"build-and-deploy-to-cloud-run",children:"Build and deploy to cloud run"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'export SERVICE_NAME=""\nexport DOCKER_TAG="rest-api:0.1"\ngcloud beta run deploy $SERVICE_NAME \\\n  --image gcr.io/$GOOGLE_CLOUD_PROJECT/$DOCKER_TAG \\\n  --platform managed \\\n  --region us-central1 \\\n  --allow-unauthenticated\n'})}),"\n",(0,c.jsx)(t.h3,{id:"get-deployment-url",children:"Get deployment url"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'export LAB_REPORT_SERVICE_URL=$(gcloud run services describe lab-report-service --platform managed --region us-central1 --format="value(status.address.url)")\n'})})]})}function u(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},1151:(e,t,o)=>{o.d(t,{Z:()=>s,a:()=>l});var c=o(7294);const n={},r=c.createContext(n);function l(e){const t=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),c.createElement(r.Provider,{value:t},e.children)}}}]);